<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora Estilo Windows</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI&display=swap" rel="stylesheet">

    <!-- ============================================= -->
    <!--  INICIO DEL CÓDIGO CSS (para style.css)       -->
    <!-- ============================================= -->
    <style>
        :root {
            --bg-color: #f3f3f3;
            --button-bg: #fafafa;
            --button-hover-bg: #e6e6e6;
            --operator-button-bg: #f0f0f0;
            --operator-button-hover-bg: #dcdcdc;
            --equal-button-bg: #8ab4f8;
            --equal-button-hover-bg: #7c9fe1;
            --text-color: #000;
            --display-text-color: #000;
            --border-color: #ccc;
        }

        /* Agrega un tema oscuro opcional si lo deseas */
        body.dark-theme {
            --bg-color: #1c1c1c;
            --button-bg: #2d2d2d;
            --button-hover-bg: #3c3c3c;
            --operator-button-bg: #252525;
            --operator-button-hover-bg: #333333;
            --equal-button-bg: #005a9e;
            --equal-button-hover-bg: #004a8e;
            --text-color: #fff;
            --display-text-color: #fff;
            --border-color: #444;
        }

        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            transition: background-color 0.3s;
        }

        .calculator-container {
            width: 100%;
            max-width: 360px;
            background-color: var(--bg-color);
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        /* --- Pantalla de la Calculadora --- */
        .calculator-display {
            width: 100%;
            text-align: right;
            padding: 20px 10px;
            color: var(--display-text-color);
            border: none;
            background-color: transparent;
        }

        .previous-operand {
            font-size: 1.2rem;
            color: #888;
            min-height: 24px; /* Evita saltos de diseño */
        }

        .current-operand {
            font-size: 2.5rem;
            font-weight: 600;
            word-wrap: break-word;
            word-break: break-all;
            min-height: 50px; /* Evita saltos de diseño */
        }

        hr {
            border: none;
            height: 1px;
            background-color: var(--border-color);
            margin: 5px 0;
        }

        /* --- Teclado de la Calculadora --- */
        .calculator-keys {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
        }

        .key {
            border: 1px solid transparent;
            border-radius: 5px;
            padding: 18px;
            font-size: 1.2rem;
            font-weight: 500;
            cursor: pointer;
            background-color: var(--button-bg);
            color: var(--text-color);
            transition: background-color 0.2s, box-shadow 0.2s;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .key:hover {
            background-color: var(--button-hover-bg);
            box-shadow: 0 0 5px rgba(0,0,0,0.1);
        }

        .key:active {
            transform: scale(0.98);
        }
        
        /* Estilos específicos para diferentes tipos de botones */
        .key--number, .key--decimal {
            font-weight: bold;
        }

        .key--operator, .key--function {
            background-color: var(--operator-button-bg);
        }

        .key--operator:hover, .key--function:hover {
             background-color: var(--operator-button-hover-bg);
        }

        .key--equal {
            grid-column: span 2;
            background-color: var(--equal-button-bg);
            color: white;
            font-weight: bold;
        }
        
        .key--equal:hover {
            background-color: var(--equal-button-hover-bg);
        }
    </style>
    <!-- ============================================= -->
    <!--  FIN DEL CÓDIGO CSS                           -->
    <!-- ============================================= -->

</head>
<body>

    <!-- ============================================= -->
    <!--  INICIO DEL CÓDIGO HTML (para index.html)     -->
    <!-- ============================================= -->
    <div class="calculator-container">
        <!-- Pantalla de la calculadora -->
        <div class="calculator-display">
            <div id="previous-operand" class="previous-operand"></div>
            <div id="current-operand" class="current-operand">0</div>
        </div>

        <hr>

        <!-- Teclado de la calculadora -->
        <div class="calculator-keys">
            <button class="key key--function" data-action="percent">%</button>
            <button class="key key--function" data-action="clear-entry">CE</button>
            <button class="key key--function" data-action="clear-all">C</button>
            <button class="key key--function" data-action="backspace">⌫</button>

            <button class="key key--function" data-action="inverse">1/x</button>
            <button class="key key--function" data-action="square">x²</button>
            <button class="key key--function" data-action="sqrt">√x</button>
            <button class="key key--operator" data-action="divide">÷</button>

            <button class="key key--number">7</button>
            <button class="key key--number">8</button>
            <button class="key key--number">9</button>
            <button class="key key--operator" data-action="multiply">×</button>

            <button class="key key--number">4</button>
            <button class="key key--number">5</button>
            <button class="key key--number">6</button>
            <button class="key key--operator" data-action="subtract">−</button>

            <button class="key key--number">1</button>
            <button class="key key--number">2</button>
            <button class="key key--number">3</button>
            <button class="key key--operator" data-action="add">+</button>
            
            <button class="key key--function" data-action="negate">+/-</button>
            <button class="key key--number">0</button>
            <button class="key key--decimal" data-action="decimal">.</button>
            <button class="key key--equal" data-action="calculate">=</button>
        </div>
    </div>
    <!-- ============================================= -->
    <!--  FIN DEL CÓDIGO HTML                          -->
    <!-- ============================================= -->


    <!-- ============================================= -->
    <!--  INICIO DEL CÓDIGO JS (para app.js)           -->
    <!-- ============================================= -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const calculator = {
                displayValue: '0',
                firstOperand: null,
                waitingForSecondOperand: false,
                operator: null,
            };

            const currentOperandDisplay = document.getElementById('current-operand');
            const previousOperandDisplay = document.getElementById('previous-operand');

            function updateDisplay() {
                currentOperandDisplay.textContent = calculator.displayValue;
            }

            updateDisplay();

            const keys = document.querySelector('.calculator-keys');
            keys.addEventListener('click', (event) => {
                const { target } = event;
                const { action } = target.dataset;
                const keyContent = target.textContent;
                
                if (!target.matches('button')) {
                    return;
                }

                if (!action) { // Es un número
                    inputDigit(keyContent);
                } else if (
                    action === 'add' ||
                    action === 'subtract' ||
                    action === 'multiply' ||
                    action === 'divide'
                ) {
                    handleOperator(action);
                } else if (action === 'decimal') {
                    inputDecimal(keyContent);
                } else if (action === 'clear-all') {
                    resetCalculator();
                } else if (action === 'clear-entry') {
                    clearEntry();
                } else if (action === 'calculate') {
                    handleOperator('=');
                } else if (action === 'backspace') {
                    deleteLastDigit();
                } else if (action === 'percent') {
                    handlePercent();
                } else if (action === 'inverse') {
                    handleInverse();
                } else if (action === 'square') {
                    handleSquare();
                } else if (action === 'sqrt') {
                    handleSqrt();
                } else if (action === 'negate') {
                    toggleSign();
                }
                updateDisplay();
            });

            function inputDigit(digit) {
                const { displayValue, waitingForSecondOperand } = calculator;

                if (waitingForSecondOperand === true) {
                    calculator.displayValue = digit;
                    calculator.waitingForSecondOperand = false;
                } else {
                    calculator.displayValue = displayValue === '0' ? digit : displayValue + digit;
                }
            }

            function inputDecimal(dot) {
                 if (calculator.waitingForSecondOperand) {
                     calculator.displayValue = "0.";
                     calculator.waitingForSecondOperand = false;
                     return;
                 }
                if (!calculator.displayValue.includes(dot)) {
                    calculator.displayValue += dot;
                }
            }

            function handleOperator(nextOperator) {
                const { firstOperand, displayValue, operator } = calculator;
                const inputValue = parseFloat(displayValue);

                if (operator && calculator.waitingForSecondOperand) {
                    calculator.operator = nextOperator;
                    updatePreviousDisplay();
                    return;
                }

                if (firstOperand == null && !isNaN(inputValue)) {
                    calculator.firstOperand = inputValue;
                } else if (operator) {
                    const result = calculate(firstOperand, inputValue, operator);
                    calculator.displayValue = `${parseFloat(result.toFixed(10))}`;
                    calculator.firstOperand = result;
                }
                
                calculator.waitingForSecondOperand = true;
                calculator.operator = nextOperator;
                updatePreviousDisplay();
            }

            function calculate(first, second, op) {
                if (op === 'add') return first + second;
                if (op === 'subtract') return first - second;
                if (op === 'multiply') return first * second;
                if (op === 'divide') return first / second;
                
                return second; // Para el igual
            }

            function resetCalculator() {
                calculator.displayValue = '0';
                calculator.firstOperand = null;
                calculator.waitingForSecondOperand = false;
                calculator.operator = null;
                previousOperandDisplay.textContent = '';
            }

            function clearEntry() {
                calculator.displayValue = '0';
            }

            function deleteLastDigit() {
                if(calculator.displayValue.length === 1 || calculator.displayValue === '-0'){
                    calculator.displayValue = '0';
                } else {
                    calculator.displayValue = calculator.displayValue.slice(0, -1);
                }
            }
            
            function updatePreviousDisplay() {
                const { firstOperand, operator } = calculator;
                let operatorSymbol = '';
                if(operator) {
                    switch(operator) {
                        case 'add': operatorSymbol = '+'; break;
                        case 'subtract': operatorSymbol = '−'; break;
                        case 'multiply': operatorSymbol = '×'; break;
                        case 'divide': operatorSymbol = '÷'; break;
                        case '=': operatorSymbol = ''; break;
                    }
                }
                
                if(firstOperand !== null && operator !== '=') {
                    previousOperandDisplay.textContent = `${firstOperand} ${operatorSymbol}`;
                } else {
                     previousOperandDisplay.textContent = '';
                }

                if(operator === '='){
                     calculator.firstOperand = null;
                     calculator.operator = null;
                     calculator.waitingForSecondOperand = false;
                }
            }
            
            // --- Funciones Unarias ---
            function handlePercent() {
                const { displayValue, firstOperand } = calculator;
                const currentValue = parseFloat(displayValue);
                if (firstOperand !== null) {
                    calculator.displayValue = `${parseFloat((firstOperand * (currentValue / 100)).toFixed(10))}`;
                } else {
                     calculator.displayValue = `${parseFloat((currentValue / 100).toFixed(10))}`;
                }
            }

            function handleInverse() {
                 const currentValue = parseFloat(calculator.displayValue);
                 if (currentValue === 0) {
                     calculator.displayValue = 'Error';
                     return;
                 }
                 calculator.displayValue = `${parseFloat((1/currentValue).toFixed(10))}`;
            }

            function handleSquare() {
                 const currentValue = parseFloat(calculator.displayValue);
                 calculator.displayValue = `${parseFloat((currentValue * currentValue).toFixed(10))}`;
            }
            
            function handleSqrt() {
                 const currentValue = parseFloat(calculator.displayValue);
                 if (currentValue < 0) {
                     calculator.displayValue = 'Error';
                     return;
                 }
                 calculator.displayValue = `${parseFloat(Math.sqrt(currentValue).toFixed(10))}`;
            }

            function toggleSign() {
                const currentValue = parseFloat(calculator.displayValue);
                if (currentValue === 0) return;
                calculator.displayValue = `${currentValue * -1}`;
            }

        });
    </script>
    <!-- ============================================= -->
    <!--  FIN DEL CÓDIGO JS                            -->
    <!-- ============================================= -->

</body>
</html>
